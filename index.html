<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Smartphone Configurator PRO</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* Кнопка налаштувань */
        #menu-toggle {
            position: absolute; top: 15px; right: 15px; z-index: 101;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; width: 50px; height: 50px; border-radius: 50%;
            cursor: pointer; font-size: 24px; backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }

        /* Адаптивне меню */
        #ui {
            position: absolute; top: 75px; right: 15px; z-index: 100;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);
            padding: 20px; border-radius: 15px; color: white;
            border: 1px solid #333; width: 220px;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1; pointer-events: auto;
        }

        #ui.hidden { opacity: 0; pointer-events: none; transform: translateY(-10px); }

        label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 5px; }
        input { width: 100%; margin-bottom: 15px; cursor: pointer; }
        input[type="text"] { background: #1a1a1a; border: 1px solid #444; color: white; padding: 8px; width: calc(100% - 18px); border-radius: 5px; outline: none; }
        
        .donate-btn {
            display: block; background: #f0c419; color: #000; text-align: center;
            padding: 10px; border-radius: 8px; text-decoration: none;
            font-weight: bold; font-size: 12px; transition: 0.3s;
        }

        /* Мобільна адаптація меню */
        @media (max-width: 480px) {
            #ui { width: 180px; padding: 15px; font-size: 14px; }
            #menu-toggle { width: 44px; height: 44px; font-size: 20px; }
        }
    </style>
</head>
<body>

<div id="menu-toggle">⚙️</div>

<div id="ui" class="hidden">
    <label>Колір корпусу</label>
    <input type="color" id="color" value="#333333">
    
    <label>Прозорість</label>
    <input type="range" id="alpha" min="0.1" max="1" step="0.1" value="1">

    <label>Текст на екрані</label>
    <input type="text" id="screenText" placeholder="Напишіть щось..." maxlength="12">

    <div style="margin-top: 15px;">
    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=mr.karalyp@gmail.com&su=Обговорення%203D%20віджета" 
       target="_blank" 
       class="donate-btn" 
       style="background: #28a745; color: #fff; margin-bottom: 8px; border: none; display: block; text-decoration: none;">
        ✉️ Написати в Gmail
    </a>
    
    <div style="font-size: 11px; color: #aaa; text-align: center; word-break: break-all;">
        Або скопіюйте адресу:<br>
        <span style="color: #00ff88; user-select: all;">mr.karalyp@gmail.com</span>
    </div>
</div>

<script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>

<script>
    let scene, camera, renderer, phone, isDragging = false, phoneBody, screenTex, canvas, ctx;
    let prevMouse = { x: 0, y: 0 };

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);

        camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = window.innerWidth < 480 ? 7.5 : 5.5;

        renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Потужне світло
        const mainLight = new THREE.DirectionalLight(0xffffff, 2.5);
        mainLight.position.set(5, 10, 7.5);
        scene.add(mainLight);
        scene.add(new THREE.AmbientLight(0xffffff, 0.4));

        buildPhone();

        // Керування меню
        const menu = document.getElementById('ui');
        const btn = document.getElementById('menu-toggle');
        btn.onclick = () => {
            menu.classList.toggle('hidden');
            btn.innerText = menu.classList.contains('hidden') ? '⚙️' : '✕';
        };

        // Взаємодія (Touch + Mouse)
        const start = (x, y) => { isDragging = true; prevMouse = { x, y }; };
        const end = () => isDragging = false;
        
        window.addEventListener('mousedown', e => start(e.clientX, e.clientY));
        window.addEventListener('mouseup', end);
        window.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));

        window.addEventListener('touchstart', e => start(e.touches[0].clientX, e.touches[0].clientY), {passive: false});
        window.addEventListener('touchend', end);
        window.addEventListener('touchmove', e => {
            if(isDragging && e.cancelable) e.preventDefault();
            handleMove(e.touches[0].clientX, e.touches[0].clientY);
        }, {passive: false});
    }

    function handleMove(x, y) {
        if(isDragging && phone) {
            phone.rotation.y += (x - prevMouse.x) * 0.007;
            phone.rotation.x += (y - prevMouse.y) * 0.007;
        }
        prevMouse = { x, y };
    }

    function buildPhone() {
        phone = new THREE.Group();
        const thick = 0.05, w = 1.1, h = 2.2, r = 0.18;

        // 1. КОРПУС
        const shape = new THREE.Shape();
        const bodyGeom = new THREE.ExtrudeGeometry(createRoundedShape(w, h, r), { depth: thick, bevelEnabled: true, bevelThickness: 0.01, bevelSize: 0.01 });
        const bodyMat = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.9, roughness: 0.1, transparent: true });
        phoneBody = new THREE.Mesh(bodyGeom, bodyMat);
        phoneBody.position.z = -thick/2;
        phone.add(phoneBody);

        // 2. ЕКРАН
        canvas = document.createElement('canvas');
        canvas.width = 512; canvas.height = 1024;
        ctx = canvas.getContext('2d');
        updateScreenText("LOGIN");
        screenTex = new THREE.CanvasTexture(canvas);
        const screenMat = new THREE.MeshPhongMaterial({ map: screenTex, emissive: 0x00ff88, emissiveIntensity: 0.2 });
        const screen = new THREE.Mesh(new THREE.PlaneGeometry(w - 0.08, h - 0.08), screenMat);
        screen.position.z = (thick/2) + 0.012;
        phone.add(screen);

        // 3. ДЕТАЛІ (ПОРТИ ТА КНОПКИ)
        const blackMat = new THREE.MeshBasicMaterial({color: 0x000000});
        
        const port = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.015, 0.04), blackMat);
        port.position.set(0, -h/2 - 0.01, 0);
        phone.add(port);

        const pwr = new THREE.Mesh(new THREE.BoxGeometry(0.015, 0.18, 0.04), blackMat);
        pwr.position.set(w/2 + 0.01, 0.4, 0);
        phone.add(pwr);

        // 4. КАМЕРИ (ПОВНИЙ БЛОК)
        const camBox = new THREE.Mesh(new THREE.BoxGeometry(0.42, 0.42, 0.04), blackMat);
        camBox.position.set(-0.25, 0.8, -thick/2 - 0.02);
        phone.add(camBox);

        for(let i=0; i<4; i++) {
            const lens = new THREE.Mesh(new THREE.CircleGeometry(0.075, 16), new THREE.MeshPhongMaterial({color: 0x080808, shininess: 200}));
            lens.position.set((i%2?-0.15:-0.35), (i<2?0.9:0.7), -thick/2 - 0.045);
            lens.rotation.y = Math.PI;
            phone.add(lens);
        }

        scene.add(phone);
    }

    function createRoundedShape(w, h, r) {
        const s = new THREE.Shape();
        s.moveTo(-w/2+r, -h/2); s.lineTo(w/2-r, -h/2);
        s.quadraticCurveTo(w/2, -h/2, w/2, -h/2+r); s.lineTo(w/2, h/2-r);
        s.quadraticCurveTo(w/2, h/2, w/2-r, h/2); s.lineTo(-w/2+r, h/2);
        s.quadraticCurveTo(-w/2, h/2, -w/2, h/2-r); s.lineTo(-w/2, -h/2+r);
        s.quadraticCurveTo(-w/2, -h/2, -w/2+r, -h/2);
        return s;
    }

    function updateScreenText(text) {
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, 512, 1024);
        ctx.fillStyle = '#00ff88'; ctx.font = 'bold 80px Arial'; ctx.textAlign = 'center';
        ctx.fillText(text.toUpperCase(), 256, 512);
        if(screenTex) screenTex.needsUpdate = true;
    }

    // Слухачі подій інтерфейсу
    document.getElementById('color').oninput = e => phoneBody.material.color.set(e.target.value);
    document.getElementById('alpha').oninput = e => phoneBody.material.opacity = parseFloat(e.target.value);
    document.getElementById('screenText').oninput = e => updateScreenText(e.target.value || "LOGIN");

    function animate() {
        requestAnimationFrame(animate);
        if (phone && !isDragging) {
            phone.rotation.y += 0.005;
            phone.position.y = Math.sin(Date.now() * 0.001) * 0.03;
        }
        renderer.render(scene, camera);
    }

    window.onresize = () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.position.z = window.innerWidth < 480 ? 7.5 : 5.5;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    };
</script>
</body>
</html>
